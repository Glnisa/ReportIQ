"""
Vulnerability Dictionary for ReportIQ
Contains common Tenable plugin descriptions and remediation guidance
"""

from typing import Dict, Optional, Any


class VulnerabilityDictionary:
    """
    Built-in dictionary for common vulnerabilities.
    Falls back to Excel PLUGINDESC for unknown plugins.
    """
    
    # Common Tenable Plugin IDs with descriptions
    PLUGINS: Dict[str, Dict[str, Any]] = {
        # Informational
        "10180": {
            "name_en": "Ping the remote host",
            "name_tr": "Uzak Host'a Ping",
            "description_en": "The remote host answered to an ICMP echo request. This indicates the host is reachable.",
            "description_tr": "Uzak host ICMP echo isteÄŸine yanÄ±t verdi. Bu, host'un eriÅŸilebilir olduÄŸunu gÃ¶sterir.",
            "severity": "Info",
            "category": "Network"
        },
        "11219": {
            "name_en": "Nessus SYN scanner",
            "name_tr": "Nessus SYN TarayÄ±cÄ±",
            "description_en": "This plugin performs a port scan using a SYN (half-open) technique.",
            "description_tr": "Bu eklenti SYN (half-open) tekniÄŸi kullanarak port taramasÄ± yapar.",
            "severity": "Info",
            "category": "Network"
        },
        "19506": {
            "name_en": "Nessus Scan Information",
            "name_tr": "Nessus Tarama Bilgisi",
            "description_en": "Contains information about the Nessus scan itself, including start time, duration, and plugins used.",
            "description_tr": "Tarama baÅŸlangÄ±Ã§ zamanÄ±, sÃ¼resi ve kullanÄ±lan eklentiler dahil olmak Ã¼zere Nessus taramasÄ± hakkÄ±nda bilgi iÃ§erir.",
            "severity": "Info",
            "category": "Scan Info"
        },
        
        # Critical Vulnerabilities
        "34477": {
            "name_en": "MS08-067: Microsoft Windows Server Service Crafted RPC Request Handling Remote Code Execution",
            "name_tr": "MS08-067: Microsoft Windows Server Hizmeti RPC Ä°steÄŸi Ä°ÅŸleme Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma",
            "description_en": "The remote Windows host is affected by a vulnerability in the Server service that could allow remote code execution.",
            "description_tr": "Uzak Windows host'u, uzaktan kod Ã§alÄ±ÅŸtÄ±rmaya izin verebilecek bir Server hizmeti gÃ¼venlik aÃ§Ä±ÄŸÄ±ndan etkileniyor.",
            "severity": "Critical",
            "remediation_en": "Apply Microsoft patch MS08-067.",
            "remediation_tr": "Microsoft MS08-067 yamasÄ±nÄ± uygulayÄ±n.",
            "category": "Windows"
        },
        "97833": {
            "name_en": "MS17-010: Security Update for Microsoft Windows SMB Server (EternalBlue)",
            "name_tr": "MS17-010: Microsoft Windows SMB Sunucusu iÃ§in GÃ¼venlik GÃ¼ncellemesi (EternalBlue)",
            "description_en": "The remote Windows host is affected by multiple vulnerabilities in Microsoft SMBv1 that could allow remote code execution.",
            "description_tr": "Uzak Windows host'u, uzaktan kod Ã§alÄ±ÅŸtÄ±rmaya izin verebilecek Microsoft SMBv1'deki birden fazla gÃ¼venlik aÃ§Ä±ÄŸÄ±ndan etkileniyor.",
            "severity": "Critical",
            "remediation_en": "Apply Microsoft patch MS17-010. Disable SMBv1 if not required.",
            "remediation_tr": "Microsoft MS17-010 yamasÄ±nÄ± uygulayÄ±n. Gerekli deÄŸilse SMBv1'i devre dÄ±ÅŸÄ± bÄ±rakÄ±n.",
            "category": "Windows"
        },
        
        # High Vulnerabilities
        "10079": {
            "name_en": "Anonymous FTP Enabled",
            "name_tr": "Anonim FTP Etkin",
            "description_en": "The remote FTP server allows anonymous logins, which could expose sensitive data.",
            "description_tr": "Uzak FTP sunucusu anonim giriÅŸlere izin veriyor, bu hassas verileri aÃ§Ä±ÄŸa Ã§Ä±karabilir.",
            "severity": "High",
            "remediation_en": "Disable anonymous FTP access unless specifically required.",
            "remediation_tr": "Ã–zellikle gerekli olmadÄ±kÃ§a anonim FTP eriÅŸimini devre dÄ±ÅŸÄ± bÄ±rakÄ±n.",
            "category": "FTP"
        },
        "10263": {
            "name_en": "SMTP Server EXPN Command Information Disclosure",
            "name_tr": "SMTP Sunucusu EXPN Komutu Bilgi Ä°fÅŸasÄ±",
            "description_en": "The remote SMTP server responds to the EXPN command, potentially exposing user information.",
            "description_tr": "Uzak SMTP sunucusu EXPN komutuna yanÄ±t veriyor, bu potansiyel olarak kullanÄ±cÄ± bilgilerini aÃ§Ä±ÄŸa Ã§Ä±karabilir.",
            "severity": "Medium",
            "category": "Mail"
        },
        
        # SSL/TLS Vulnerabilities
        "20007": {
            "name_en": "SSL Version 2 and 3 Protocol Detection",
            "name_tr": "SSL SÃ¼rÃ¼m 2 ve 3 Protokol Tespiti",
            "description_en": "The remote service accepts connections encrypted using SSL 2.0 and/or SSL 3.0, which have known vulnerabilities.",
            "description_tr": "Uzak hizmet, bilinen gÃ¼venlik aÃ§Ä±klarÄ± bulunan SSL 2.0 ve/veya SSL 3.0 kullanÄ±larak ÅŸifrelenmiÅŸ baÄŸlantÄ±larÄ± kabul ediyor.",
            "severity": "Medium",
            "remediation_en": "Disable SSL 2.0 and 3.0. Use TLS 1.2 or higher.",
            "remediation_tr": "SSL 2.0 ve 3.0'Ä± devre dÄ±ÅŸÄ± bÄ±rakÄ±n. TLS 1.2 veya Ã¼stÃ¼nÃ¼ kullanÄ±n.",
            "category": "SSL/TLS"
        },
        "42873": {
            "name_en": "SSL Medium Strength Cipher Suites Supported",
            "name_tr": "SSL Orta GÃ¼Ã§lÃ¼ Åžifre Paketleri Destekleniyor",
            "description_en": "The remote host supports SSL cipher suites offering medium strength encryption.",
            "description_tr": "Uzak host, orta gÃ¼Ã§lÃ¼ ÅŸifreleme sunan SSL ÅŸifre paketlerini destekliyor.",
            "severity": "Medium",
            "remediation_en": "Reconfigure the server to use only strong cipher suites.",
            "remediation_tr": "Sunucuyu yalnÄ±zca gÃ¼Ã§lÃ¼ ÅŸifre paketlerini kullanacak ÅŸekilde yeniden yapÄ±landÄ±rÄ±n.",
            "category": "SSL/TLS"
        },
        "57582": {
            "name_en": "SSL Self-Signed Certificate",
            "name_tr": "SSL Kendinden Ä°mzalÄ± Sertifika",
            "description_en": "The SSL certificate chain for this service ends in an untrusted certificate (self-signed).",
            "description_tr": "Bu hizmet iÃ§in SSL sertifika zinciri gÃ¼venilmeyen bir sertifikada (kendinden imzalÄ±) sona eriyor.",
            "severity": "Medium",
            "remediation_en": "Replace the self-signed certificate with a certificate from a trusted CA.",
            "remediation_tr": "Kendinden imzalÄ± sertifikayÄ± gÃ¼venilir bir CA'dan alÄ±nan bir sertifikayla deÄŸiÅŸtirin.",
            "category": "SSL/TLS"
        },
        "65821": {
            "name_en": "SSL RC4 Cipher Suites Supported",
            "name_tr": "SSL RC4 Åžifre Paketleri Destekleniyor",
            "description_en": "The remote host supports RC4 cipher suites which are considered weak.",
            "description_tr": "Uzak host, zayÄ±f kabul edilen RC4 ÅŸifre paketlerini destekliyor.",
            "severity": "Low",
            "category": "SSL/TLS"
        },
        
        # Unsupported Software
        "33850": {
            "name_en": "Unsupported Unix Operating System",
            "name_tr": "Desteklenmeyen Unix Ä°ÅŸletim Sistemi",
            "description_en": "The remote host is running an operating system that is no longer supported by its vendor.",
            "description_tr": "Uzak host, satÄ±cÄ±sÄ± tarafÄ±ndan artÄ±k desteklenmeyen bir iÅŸletim sistemi Ã§alÄ±ÅŸtÄ±rÄ±yor.",
            "severity": "Critical",
            "remediation_en": "Upgrade to a supported version of the operating system.",
            "remediation_tr": "Ä°ÅŸletim sisteminin desteklenen bir sÃ¼rÃ¼mÃ¼ne yÃ¼kseltin.",
            "category": "OS"
        },
        "108797": {
            "name_en": "Unsupported Python Version",
            "name_tr": "Desteklenmeyen Python SÃ¼rÃ¼mÃ¼",
            "description_en": "The remote host has an unsupported version of Python installed that no longer receives security updates.",
            "description_tr": "Uzak host'ta artÄ±k gÃ¼venlik gÃ¼ncellemesi almayan desteklenmeyen bir Python sÃ¼rÃ¼mÃ¼ yÃ¼klÃ¼.",
            "severity": "High",
            "remediation_en": "Upgrade to a supported version of Python.",
            "remediation_tr": "Python'un desteklenen bir sÃ¼rÃ¼mÃ¼ne yÃ¼kseltin.",
            "category": "Software"
        },
        "156899": {
            "name_en": "Unsupported Windows Operating System",
            "name_tr": "Desteklenmeyen Windows Ä°ÅŸletim Sistemi",
            "description_en": "The remote Windows host is running an operating system that is no longer supported.",
            "description_tr": "Uzak Windows host, artÄ±k desteklenmeyen bir iÅŸletim sistemi Ã§alÄ±ÅŸtÄ±rÄ±yor.",
            "severity": "Critical",
            "remediation_en": "Upgrade to a supported version of Windows.",
            "remediation_tr": "Windows'un desteklenen bir sÃ¼rÃ¼mÃ¼ne yÃ¼kseltin.",
            "category": "Windows"
        },
        
        # Web Application
        "10662": {
            "name_en": "Web Server HTTP TRACE/TRACK Method Support",
            "name_tr": "Web Sunucusu HTTP TRACE/TRACK Metod DesteÄŸi",
            "description_en": "The remote web server supports TRACE and/or TRACK methods which can be used in cross-site scripting attacks.",
            "description_tr": "Uzak web sunucusu, cross-site scripting saldÄ±rÄ±larÄ±nda kullanÄ±labilecek TRACE ve/veya TRACK metotlarÄ±nÄ± destekliyor.",
            "severity": "Medium",
            "category": "Web"
        },
        "11213": {
            "name_en": "HTTP TRACE Method Allowed",
            "name_tr": "HTTP TRACE Metodu Ä°zinli",
            "description_en": "The remote server supports the TRACE method which can facilitate cross-site tracing attacks.",
            "description_tr": "Uzak sunucu, cross-site tracing saldÄ±rÄ±larÄ±nÄ± kolaylaÅŸtÄ±rabilecek TRACE metodunu destekliyor.",
            "severity": "Medium",
            "category": "Web"
        },
        
        # SQL Injection
        "42479": {
            "name_en": "SQL Injection",
            "name_tr": "SQL Enjeksiyonu",
            "description_en": "A SQL injection vulnerability was detected in the remote web application.",
            "description_tr": "Uzak web uygulamasÄ±nda bir SQL enjeksiyonu gÃ¼venlik aÃ§Ä±ÄŸÄ± tespit edildi.",
            "severity": "Critical",
            "remediation_en": "Validate and sanitize user input. Use parameterized queries.",
            "remediation_tr": "KullanÄ±cÄ± girdisini doÄŸrulayÄ±n ve temizleyin. Parametreli sorgular kullanÄ±n.",
            "category": "Web"
        },
        
        # Missing Patches
        "66334": {
            "name_en": "Patch Report",
            "name_tr": "Yama Raporu",
            "description_en": "Shows missing patches on the remote host.",
            "description_tr": "Uzak host'taki eksik yamalarÄ± gÃ¶sterir.",
            "severity": "Info",
            "category": "Patches"
        },
        
        # Default Credentials
        "10862": {
            "name_en": "SSH Server Default Credentials",
            "name_tr": "SSH Sunucusu VarsayÄ±lan Kimlik Bilgileri",
            "description_en": "The remote SSH server can be accessed using default credentials.",
            "description_tr": "Uzak SSH sunucusuna varsayÄ±lan kimlik bilgileri kullanÄ±larak eriÅŸilebilir.",
            "severity": "Critical",
            "remediation_en": "Change the default password immediately.",
            "remediation_tr": "VarsayÄ±lan ÅŸifreyi hemen deÄŸiÅŸtirin.",
            "category": "SSH"
        },
        
        # Network Services
        "10287": {
            "name_en": "Traceroute Information",
            "name_tr": "Traceroute Bilgisi",
            "description_en": "Reports the network path from the scanner to the target host.",
            "description_tr": "TarayÄ±cÄ±dan hedef host'a aÄŸ yolunu raporlar.",
            "severity": "Info",
            "category": "Network"
        },
        "22964": {
            "name_en": "Service Detection",
            "name_tr": "Hizmet Tespiti",
            "description_en": "Reports the service running on a specific port.",
            "description_tr": "Belirli bir portta Ã§alÄ±ÅŸan hizmeti raporlar.",
            "severity": "Info",
            "category": "Network"
        },
        
        # Additional Common Vulnerabilities
        "12053": {
            "name_en": "Host Fully Qualified Domain Name (FQDN) Resolution",
            "name_tr": "Host Tam Nitelikli Alan AdÄ± (FQDN) Ã‡Ã¶zÃ¼mlemesi",
            "description_en": "Reports the FQDN determined by reverse DNS lookup.",
            "description_tr": "Ters DNS aramasÄ±yla belirlenen FQDN'yi raporlar.",
            "severity": "Info",
            "category": "Network"
        },
        "35291": {
            "name_en": "SSL Certificate Cannot Be Trusted",
            "name_tr": "SSL SertifikasÄ± GÃ¼venilir DeÄŸil",
            "description_en": "The SSL certificate for this server cannot be trusted.",
            "description_tr": "Bu sunucu iÃ§in SSL sertifikasÄ±na gÃ¼venilemez.",
            "severity": "Medium",
            "category": "SSL/TLS"
        },
        "51192": {
            "name_en": "SSL Certificate Expiry",
            "name_tr": "SSL Sertifika SÃ¼resi DolmasÄ±",
            "description_en": "The SSL certificate for this server is expired or will expire soon.",
            "description_tr": "Bu sunucu iÃ§in SSL sertifikasÄ±nÄ±n sÃ¼resi dolmuÅŸ veya yakÄ±nda dolacak.",
            "severity": "Medium",
            "remediation_en": "Renew the SSL certificate before it expires.",
            "remediation_tr": "SÃ¼resi dolmadan Ã¶nce SSL sertifikasÄ±nÄ± yenileyin.",
            "category": "SSL/TLS"
        },
        "104743": {
            "name_en": "TLS Version 1.0 Protocol Detection",
            "name_tr": "TLS SÃ¼rÃ¼m 1.0 Protokol Tespiti",
            "description_en": "The remote service accepts connections encrypted using TLS 1.0 which has known weaknesses.",
            "description_tr": "Uzak hizmet, bilinen zayÄ±flÄ±klarÄ± olan TLS 1.0 kullanÄ±larak ÅŸifrelenmiÅŸ baÄŸlantÄ±larÄ± kabul ediyor.",
            "severity": "Medium",
            "remediation_en": "Disable TLS 1.0 and use TLS 1.2 or higher.",
            "remediation_tr": "TLS 1.0'Ä± devre dÄ±ÅŸÄ± bÄ±rakÄ±n ve TLS 1.2 veya Ã¼stÃ¼nÃ¼ kullanÄ±n.",
            "category": "SSL/TLS"
        },
        "157288": {
            "name_en": "TLS Version 1.1 Protocol Deprecated",
            "name_tr": "TLS SÃ¼rÃ¼m 1.1 ProtokolÃ¼ KullanÄ±mdan KaldÄ±rÄ±ldÄ±",
            "description_en": "The remote service supports TLS 1.1, which is deprecated.",
            "description_tr": "Uzak hizmet, kullanÄ±mdan kaldÄ±rÄ±lan TLS 1.1'i destekliyor.",
            "severity": "Low",
            "category": "SSL/TLS"
        },
    }
    
    # Severity color mapping
    SEVERITY_COLORS = {
        "Critical": "#FF4444",
        "High": "#FF8800",
        "Medium": "#FFCC00",
        "Low": "#00CC66",
        "Info": "#4488FF"
    }
    
    # Category icons
    CATEGORY_ICONS = {
        "Windows": "ðŸªŸ",
        "Network": "ðŸŒ",
        "SSL/TLS": "ðŸ”’",
        "Web": "ðŸŒ",
        "Software": "ðŸ“¦",
        "OS": "ðŸ’»",
        "SSH": "ðŸ”‘",
        "FTP": "ðŸ“",
        "Mail": "ðŸ“§",
        "Patches": "ðŸ©¹",
        "Scan Info": "ðŸ“‹"
    }
    
    @classmethod
    def get_plugin(cls, plugin_id: str) -> Optional[Dict[str, Any]]:
        """Get plugin information by ID"""
        return cls.PLUGINS.get(str(plugin_id))
    
    @classmethod
    def get_description(cls, plugin_id: str, language: str = "EN", fallback_desc: str = "") -> str:
        """Get plugin description in specified language"""
        plugin = cls.get_plugin(plugin_id)
        if plugin:
            key = f"description_{language.lower()}"
            return plugin.get(key, plugin.get("description_en", fallback_desc))
        return fallback_desc
    
    @classmethod
    def get_name(cls, plugin_id: str, language: str = "EN", fallback_name: str = "") -> str:
        """Get plugin name in specified language"""
        plugin = cls.get_plugin(plugin_id)
        if plugin:
            key = f"name_{language.lower()}"
            return plugin.get(key, plugin.get("name_en", fallback_name))
        return fallback_name
    
    @classmethod
    def get_remediation(cls, plugin_id: str, language: str = "EN") -> Optional[str]:
        """Get remediation guidance in specified language"""
        plugin = cls.get_plugin(plugin_id)
        if plugin:
            key = f"remediation_{language.lower()}"
            return plugin.get(key, plugin.get("remediation_en"))
        return None
    
    @classmethod
    def get_severity(cls, plugin_id: str) -> str:
        """Get plugin severity"""
        plugin = cls.get_plugin(plugin_id)
        if plugin:
            return plugin.get("severity", "Unknown")
        return "Unknown"
    
    @classmethod
    def get_severity_color(cls, severity: str) -> str:
        """Get color for severity level"""
        return cls.SEVERITY_COLORS.get(severity, "#888888")
    
    @classmethod
    def get_category(cls, plugin_id: str) -> str:
        """Get plugin category"""
        plugin = cls.get_plugin(plugin_id)
        if plugin:
            return plugin.get("category", "Other")
        return "Other"
    
    @classmethod
    def get_category_icon(cls, category: str) -> str:
        """Get icon for category"""
        return cls.CATEGORY_ICONS.get(category, "ðŸ“Œ")
    
    @classmethod
    def has_plugin(cls, plugin_id: str) -> bool:
        """Check if plugin exists in dictionary"""
        return str(plugin_id) in cls.PLUGINS
